<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خريطة جوجل - المناطق والمواقع</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: top;
            word-wrap: break-word;
        }
        th {
            background-color: #f2f2f2;
            text-align: center;
        }
        .map-container {
            width: 400px;
            height: 400px;
        }
        .locations-list {
            list-style-type: none;
            padding: 0;
        }
        .locations-list li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <h1>عرض المناطق والمواقع على خريطة جوجل</h1>

    <table>
        <thead>
            <tr>
                <th>المنطقة</th>
                <th>المواقع والمسافات</th>
                <th>الخريطة</th>
            </tr>
        </thead>
        <tbody id="regionsTable">
            <!-- الصفوف ستُضاف هنا ديناميكياً -->
        </tbody>
    </table>

    <!-- إدراج مكتبة Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuoser5drR-xx8k9GzGz3d8FZNBY60_LE"></script>
    <script>
        // استبدل YOUR_API_KEY بمفتاح API الخاص بك من Google Maps

        // البيانات الخاصة بالمناطق والمواقع
        const regionsData = {
            "نجران": [
                {name: "نــــور العريسة", lat: 17.565, lng: 44.223},
                {name: "نـــــور الغثمة", lat: 17.575, lng: 44.233},
                {name: "نـــــور شرورة", lat: 17.485, lng: 44.243},
                {name: "نـــــور مكة", lat: 21.422, lng: 39.826},
                {name: "نـــــور حبونا", lat: 17.495, lng: 44.253},
                // أضف باقي المواقع هنا...
            ],
            // يمكنك إضافة المزيد من المناطق والمواقع هنا
            // "منطقة أخرى": [ ... ]
        };

        // تهيئة الجدول عند تحميل الصفحة
        window.onload = function() {
            const tableBody = document.getElementById('regionsTable');
            for (const region in regionsData) {
                const row = document.createElement('tr');

                // عمود اسم المنطقة
                const regionCell = document.createElement('td');
                regionCell.textContent = region;
                row.appendChild(regionCell);

                // عمود قائمة المواقع والمسافات
                const locationsCell = document.createElement('td');
                const locationsList = document.createElement('ul');
                locationsList.className = 'locations-list';
                // إضافة بيانات المواقع مع مكان لعرض المسافة
                regionsData[region].forEach((location, index) => {
                    const listItem = document.createElement('li');
                    listItem.id = `location_${region}_${index}`;
                    listItem.innerHTML = `<strong>${location.name}</strong>: <span id="distance_${region}_${index}">حساب المسافة...</span>`;
                    locationsList.appendChild(listItem);
                });
                locationsCell.appendChild(locationsList);
                row.appendChild(locationsCell);

                // عمود الخريطة
                const mapCell = document.createElement('td');
                const mapDiv = document.createElement('div');
                mapDiv.id = `map_${region}`;
                mapDiv.className = 'map-container';
                mapCell.appendChild(mapDiv);
                row.appendChild(mapCell);

                tableBody.appendChild(row);

                // تهيئة الخريطة لكل منطقة
                initMap(region, regionsData[region]);
            }
        };

        // دالة لتهيئة خريطة جوجل لكل منطقة
        function initMap(region, locations) {
            if (locations.length === 0) return;

            // تحديد مركز الخريطة بناءً على أول موقع في القائمة
            const center = {lat: locations[0].lat, lng: locations[0].lng};
            const map = new google.maps.Map(document.getElementById(`map_${region}`), {
                center: center,
                zoom: 12,
            });

            // إضافة علامات (Markers) لكل موقع
            const markers = locations.map(location => {
                return new google.maps.Marker({
                    position: {lat: location.lat, lng: location.lng},
                    map: map,
                    title: location.name
                });
            });

            // حساب المسافات بين المواقع وعرضها
            calculateDistances(region, locations);
        }

        // دالة لحساب المسافات بين المواقع باستخدام Distance Matrix API
        function calculateDistances(region, locations) {
            if (locations.length < 2) return;

            const service = new google.maps.DistanceMatrixService();
            const origin = locations[0];
            const destinations = locations.slice(1).map(loc => new google.maps.LatLng(loc.lat, loc.lng));

            service.getDistanceMatrix({
                origins: [new google.maps.LatLng(origin.lat, origin.lng)],
                destinations: destinations,
                travelMode: 'DRIVING',
                unitSystem: google.maps.UnitSystem.METRIC,
            }, function(response, status) {
                if (status !== 'OK') {
                    console.error('Error with Distance Matrix Service:', status);
                    // تحديث المسافات بأنها غير متاحة
                    locations.slice(1).forEach((loc, index) => {
                        const distanceElement = document.getElementById(`distance_${region}_${index + 1}`);
                        if (distanceElement) {
                            distanceElement.textContent = 'غير متاح';
                        }
                    });
                    return;
                }

                const results = response.rows[0].elements;
                results.forEach((element, index) => {
                    const distanceText = element.distance ? element.distance.text : 'غير متاح';
                    const distanceElement = document.getElementById(`distance_${region}_${index + 1}`);
                    if (distanceElement) {
                        distanceElement.textContent = distanceText;
                    }
                });
            });
        }
    </script>

</body>
</html>
